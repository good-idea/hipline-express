var postcss = require('postcss');
var multimatch = require('multimatch');

module.exports = postcss.plugin('postcss-stream-filter', function (filter, postcssPlugin) {
    return function (css, result) {
        if (typeof filter !== 'string' && !Array.isArray(filter)) {
            throw new TypeError('The filter parameter must be a glob string or an array of glob strings!');
        }

        if (typeof postcssPlugin !== 'function') {
            throw new TypeError('The postcssPlugin parameter must be a function!');
        }

        if (multimatch(css.source.input.file, filter).length === 0) {
            return postcssPlugin(css, result);
        }
    };
});
